generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id         String         @id
  created_at DateTime       @default(now()) @db.Timestamptz(6)
  updated_at DateTime?      @default(now()) @updatedAt @db.Timestamp(6)
  email      String         @unique
  nickname   String?
  role       EnumRole       @default(GUEST)
  status     EnumUserStatus @default(JOIN)
  store      store[]

  plan     plan?      @relation(fields: [planId], references: [id])
  planId   String?
  settings settings[]
}

model receive {
  id               String             @id @default(uuid())
  serialCode       String
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @updatedAt @db.Timestamp(6)
  status           EnumStatus         @default(READY)
  receiveStatusLog receiveStatusLog[]

  // ğŸ”¥ customerì™€ì˜ 1:M ê´€ê³„ (customerId í•„ë“œ ì¶”ê°€)
  customer   customer? @relation(fields: [customerId], references: [id])
  customerId String?

  // ğŸ”¥ storeì™€ì˜ 1:M ê´€ê³„ (storeId í•„ë“œ ì¶”ê°€)
  storeId String // @unique ì†ì„±ì€ 1:1 ê´€ê³„ë¥¼ ë§Œë“­ë‹ˆë‹¤.
  store   store  @relation(fields: [storeId], references: [id])
}

model store {
  id               String    @id @default(uuid())
  created_at       DateTime  @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  name             String
  address          String?
  address_elements Json?
  phone            String?
  business_hours   Json?
  holiday          String?
  homepage         String?
  sns              Json?
  image            String[]
  description      String?
  business_number  String[]

  // ğŸ”¥ users ê´€ê³„ ì„ì‹œ ì œê±°
  // users           users    @relation(fields: [usersId], references: [id], onDelete: Cascade)
  // usersId         String

  receives receive[]
  users    users?    @relation(fields: [usersId], references: [id])
  usersId  String?
}

model customer {
  id         String    @id @default(uuid())
  phone      String    @unique // í•¸ë“œí° ë²ˆí˜¸ëŠ” ê³ ê°ì„ ì‹ë³„í•˜ëŠ” ê³ ìœ  í‚¤
  created_at DateTime  @default(now()) @db.Timestamp(6)
  receives   receive[]
}

model settings {
  id      String @id @default(uuid())
  usersId String @unique
  users   users  @relation(fields: [usersId], references: [id])

  statsPeriod   Int @default(3) // í†µê³„ ê¸°ê°„ (ì›” ë‹¨ìœ„)
  average_start Int
  average_end   Int
}

model receiveStatusLog {
  id         String     @id @default(uuid())
  receiveId  String
  receive    receive    @relation(fields: [receiveId], references: [id], onDelete: Cascade)
  status     EnumStatus
  changed_at DateTime   @default(now())
}

// enum EnumPlan {
//   BASICS //  ì ‘ìˆ˜ë§Œ ê°€ëŠ¥ (ë¬¸ì ë³´ë‚´ê¸°X)
//   PLUS // ì ‘ìˆ˜ , ì¶œë ¥ ê°€ëŠ¥
//   PREMIUM // ì ‘ìˆ˜, ì¶œë ¥, ë¬¸ì ëª¨ë‘ ê°€ëŠ¥
// }

model plan {
  id       String  @id @default(uuid())
  name     String  @unique
  features Json
  // [{ "ì ‘ìˆ˜": true, "ì¶œë ¥": false, "ë¬¸ì": true }]
  // {"receipt": true, "print": false, "send": false}
  // {"receipt": true, "print": false, "send": false}
  //  {"receipt": true, "print": false, "send": false}
  users    users[]
}

enum EnumRole {
  GUEST  @map("GUEST")
  ADMIN  @map("ADMIN")
  MASTER @map("MASTER")
}

enum EnumUserStatus {
  JOIN     @map("JOIN")
  WITHDRAW @map("WITHDRAW")
}

enum EnumStatus {
  READY     @map("READY")
  // IN_PROGRESS @map("IN_PROGRESS")
  COMPLETED @map("COMPLETED")
  CANCEL    @map("CANCEL")
}

// npx prisma migrate reset
// npx prisma migrate dev
// npx prisma db push 
