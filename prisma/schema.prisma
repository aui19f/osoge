generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("NEXT_PUBLIC_DATABASE_URL")
  directUrl = env("NEXT_PUBLIC_DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id         String         @id
  created_at DateTime       @default(now()) @db.Timestamptz(6)
  updated_at DateTime?      @default(now()) @updatedAt @db.Timestamp(6)
  email      String         @unique
  nickname   String?
  role       EnumRole       @default(GUEST)
  status     EnumUserStatus @default(JOIN)
  planId     String?
  settings   settings?
  store      store[]
  plan       plan?          @relation(fields: [planId], references: [id])
}

model receive {
  id               String             @id @default(uuid())
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @updatedAt @db.Timestamp(6)
  status           EnumStatus         @default(READY)
  customerId       String?
  storeId          String
  serialCode       String
  store            store              @relation(fields: [storeId], references: [id])
  receiveStatusLog receiveStatusLog[]
  phone            String?
  sendCount        Int?               @default(0)
}

model store {
  id               String    @id @default(uuid())
  created_at       DateTime  @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @updatedAt @db.Timestamp(6)
  name             String
  address          String?
  address_elements Json?
  phone            String?
  business_hours   Json?
  holiday          String?
  homepage         String?
  sns              Json?
  image            String[]
  description      String?
  business_number  String[]
  usersId          String?
  receives         receive[]
  users            users?    @relation(fields: [usersId], references: [id])
}

model settings {
  id            String @id @default(uuid())
  usersId       String @unique
  statsPeriod   Int    @default(3)
  average_start Int
  average_end   Int
  users         users  @relation(fields: [usersId], references: [id])
}

model receiveStatusLog {
  id         String     @id @default(uuid())
  receiveId  String
  status     EnumStatus
  changed_at DateTime   @default(now())
  receive    receive    @relation(fields: [receiveId], references: [id], onDelete: Cascade)
}

model plan {
  id       String  @id @default(uuid())
  name     String  @unique
  features Json
  users    users[]
}

enum EnumRole {
  GUEST  @map("GUEST")
  ADMIN  @map("ADMIN")
  MASTER @map("MASTER")
}

enum EnumUserStatus {
  JOIN     @map("JOIN")
  WITHDRAW @map("WITHDRAW")
}

enum EnumStatus {
  READY     @map("READY")
  COMPLETED @map("COMPLETED")
  CANCEL    @map("CANCEL")
}
